<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhita.Dao.FractionMapper" >

	<select id="AppCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		select count(id) from userapp where userId = #{userId}
	</select>
	
	
	<select id="FractionUser" parameterType="java.lang.Integer" resultType="com.zhita.Model.Rulelist">
		select * from rulelist where id = #{id}
	</select>
	
	
	<select id="Emergency_contact_infoPhone" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		select count(id) from emergency_contact_info where xiaodai_userid = #{xiaodai_userid} and left(phone_number,3) = "400" 
	</select>
	
		
	<select id="IpPhone" parameterType="java.lang.String" resultType="java.lang.Integer">
		select count(id) from configuration where wifiIP =  (select wifiIP from configuration where phone = #{phone} )
	</select>
	
	
	<select id="PhoneCount" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
		select count(id) from user 
		<where>
			<if test="phone != null and phone != ''">
				and phone = #{phone} 
			</if>
			<if test="statu_time != null and statu_time != '' and end_time != '' and end_time != null">
				and authentication_time between #{statu_time} and #{end_time}
			</if>
			<if test="idnumber != null and idnumber != ''">
				and idnumber = #{idnumber}
			</if>
		</where>
	</select>
  
  
  	<select id="UserPhoneCount" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(id) from maillist 
			<where>
				userId = #{userId} 
				<if test="phone != null and phone != ''">
					and left(phone,3) = #{phone} 
				</if> 
				<if test="name != null and name != ''">
					and `name` LIKE  "%"#{name}"%"
				</if>
			</where>
  	</select>
  	
  	
  	<insert id="AddUser" parameterType="com.zhita.Model.User">
  		INSERT INTO `user`(
  			userId,
  			idnumber,
  			username,
  			phone,
  			authentication_time,
  			fraction,
  			appId
  		)VALUES(
  		#{userId},#{idnumber},#{username},#{phone},#{authentication_time},#{fraction},#{appId}
  		)
  	</insert>
  	
  	
  	<select id="UserZuc" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  		select count(id) from user where phone = (select phone_number from emergency_contact_info where xiaodai_userid = #{userId})
  	</select>
  	
  	
  	<select id="UserAppnum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(id) from userapp  
  		<where>
  			userId = #{userId}
  			<if test="name != null and name != ''">
  				and `name` LIKE  "%"#{name}"%"
  			</if>
  		</where>
  	</select>
  	
  	
  	<select id="getId" parameterType="java.lang.String" resultType="java.lang.Integer">
  		select max(id) from user where phone = #{phone}
  	</select>
  	
  	
  	<select id="UserAppCount" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  		select count(id) from userapp where `name` LIKE  "%"#{name}"%"
  	</select>
  	
  	
  	<insert id="AddUserCount" useGeneratedKeys="true" keyProperty="id" parameterType="com.zhita.Model.Rulelist_detail">
  		INSERT INTO `rulelist_detail` (
  			rtid,
  			rid,
  			value_at_risk,
  			userid,
  			authentication_time,
  			usum
  		)values(#{rtid},#{rid},#{value_at_risk},#{userid},#{authentication_time},#{usum})
  	</insert>
  	
  	
  	<select id="SelectUserPhone" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  		select count(u.id) from maillist ma,user u where ma.phone = u.phone and ma.userId = #{userId}
  	</select>
  	
  	
  	<select id="PayUserNum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(name)  from maillist where userId = #{userId} group by name having count(name) > 1
  	</select>
  	
  	
  	<select id="PhoneNum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(phone)  from maillist where userId = #{userId} group by phone having count(phone) > 1
  	</select>
  	
  	
  	<select id="jjPhoneNum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(name)  from emergency_contact_info where xiaodai_userid = #{userId} group by name having count(name) > 1
  	</select>
  	
  	
  	<select id="PhoneNumA" parameterType="com.zhita.Model.User" resultType="java.lang.Integer" >
  		select count(id) from emergency_contact_info where xiaodai_userid = #{userId} group by left(phone_number,#{id}) 
  		having count(left(phone_number,3)) > 1 
  	</select>
  	
  	
  	<select id="ReportNum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select max(id),score from report_info where xiaodai_userid = #{userId}
  	</select>
  	
  	
  	<select id="ReportID" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select max(id) from report_info where xiaodai_userid = #{userId}
  	</select>
  	
  	
  	<select id="AppInFoUser" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select max(id) from applier_info 
  		<where>
  			<if test="phone != null and phone != ''">
  				phone_number = #{phone}
  			</if>
  			<if test="idnumber != null and idnumber != ''">
  				AND idcard = #{idnumber}
  			</if>
  			<if test="idnumber != null and idnumber != ''">
  				AND idcard = #{idnumber}
  			</if>
  			<if test="name != null and name != ''">
  				AND name = #{name}
  			</if>
  		</where> 
  	</select>
  	
  	
  	<select id="MacNum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(id) from configuration where phone = #{phone} group by wifiMac
  		having count(wifiMac) > 1 
  	</select>
  	
  	
  	<select id="PhoneUserNum" parameterType="com.zhita.Model.User" resultType="java.lang.Integer">
  		select count(id) from maillist where userId = #{userId}
  	</select>
</mapper>